<!DOCTYPE html>
<html>
  <head>
    <title>BPS Online Transportation Challenge</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="js/path.js"></script>
    <link
      rel="stylesheet" 
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" 
      integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" 
      crossorigin="anonymous">
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
      integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
      crossorigin="anonymous">
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
      integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
      crossorigin="anonymous">
    </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clusterize.js/0.17.6/clusterize.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/alertify.js/0.3.11/alertify.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handsontable/0.31.2/handsontable.full.min.js"></script>
    <link rel="stylesheet" media="screen" href="//cdnjs.cloudflare.com/ajax/libs/alertify.js/0.3.11/alertify.core.min.css">
    <link rel="stylesheet" media="screen" href="//cdnjs.cloudflare.com/ajax/libs/alertify.js/0.3.11/alertify.default.min.css">
    <link rel="stylesheet" media="screen" href="//cdnjs.cloudflare.com/ajax/libs/alertify.js/0.3.11/alertify.bootstrap.min.css">
    <link rel="stylesheet" media="screen" href="//cdnjs.cloudflare.com/ajax/libs/clusterize.js/0.17.6/clusterize.min.css">
    <link rel="stylesheet" media="screen" href="//cdnjs.cloudflare.com/ajax/libs/handsontable/0.31.2/handsontable.full.min.css">
    <link rel="stylesheet" href="css/ladda-themeless.min.css">
    <link rel="stylesheet" media="screen" href="css/style.css">
  </head>
  <body>
    <header>
      <div class="container">
        <h1>Boston Public Schools<br/>
          <small>Online Transportation Challenge</small>
        </h1>
        <div id="logos">
          <a href="https://www.bostonpublicschools.org"><img src="img/bps.png" width="120px;" alt="BPS logo"/></a>
          <a href="https://www.bu.edu"><img src="img/bu.gif" alt="BU logo"/></a>
        </div>
      </div>
    </header>
    <div id="shadow" class="ss-style-multitriangles"></div>
    <main id="content" class="container">
      <section id="session-area" class="card">
        <h2 class="text-center">Download a solution template</h2>
        <p class="text-center">Use the files below to structure your own candidate solutions. All solutions submitted for evaluation must exactly match the format of these template and example files.</p>
        <hr/>
        <div class="row">
          <div class="col-md-12">
            <table style="width:100%;">
              <tr><td><a href="bps-tc-template.xlsx">Download solution <b>template</b></a> (to be filled out by you)</td></tr>
              <tr><td><a href="bps-tc-example.xlsx">Download solution <b>example</b> file</a> (to see an example of the solution format)</td></tr>
              <tr><td><a href="bps-tc-invalid.xlsx">Download <b>invalid</b> solution example file</a> (to see examples of validation errors)</td></tr>
              <tr><td><a href="bps-tc-complete.xlsx">Download a <b>full-scale complete solution</b> file</a> (generated using <a href="https://github.com/Data-Mechanics/bps-simulated-data">bps-simulated-data</a>)</td></tr>
            </table>
            <br/>
          </div>
        </div>
      </section>
      <section id="session-area" class="card">
        <h2 class="text-center">Load and evaluate your solution</h2>
        <p class="text-center">Drag and drop your completed template file. Once the file has been loaded (which may take a few minutes for full solutions) you can select your chosen criteria and evaluate your solution by clicking <b>Evaluate</b>.</p>
        <hr/>
        <div class="row">
          <div class="col-md-4">
            <div id="drop-area">
              Drag and drop your solution file here
              <br/>
              <p>&mdash;or&mdash;</p><br/>
              <button id="choose-file-button" class="btn btn-primary">Choose file</button>
            </div>
            <input type="file" id="choose-file" accept=".xlsx,.xls,.XLSX,.XLS">
          </div>
          <div class="col-md-8">
            test
          </div>
          <div class="col-md-12">
            <div id="simulation_view" style="display:none;">
              <button onclick="simulate(workbook_js);">Evaluate</button>
              <br/><br/>
              <div class="clusterize">
                <table>
                  <thead>
                    <tr>
                      <th style="font-weight:normal;">Click <b>Simulate</b> above to begin validating and evaluating your data.</th>
                    </tr>
                  </thead>
                </table>
                <br/>
                <div id="scrollArea" class="clusterize-scroll">
                  <table>
                    <tbody id="contentArea" class="clusterize-content">
                      <!--tr class="clusterize-no-data">
                        <td style="text-align:left; text-decoration:underline;"><b>Simulation Progress and Results</b></td>
                      </tr-->
                    </tbody>
                  </table>
                </div>
              </div>
              <br/>
            </div>
          </div>
        </div>
      </section>
      <section id="instructions" class="card">
        <h2 class="text-center">Review your loaded solution</h2>
        <p class="text-center">You may examine your loaded solution below, if you wish to do so.</p>
        <span id="expand-table-button" class="arrow-down"></span>
        <div id="tables-area">
          <div id="spreadsheet_view"  style="display:none;">
            <div id="buttons"></div>
            <div id="hot" style="overflow:scroll" class="handsontable"></div>
          </div>
        </div>
      </section>
      <section class="card">
        <h2 class="text-center">Submit and post your score</h2>
        <p class="text-center">If you are satisfied with your evaluation, you may post your score for the record.</p>
        <hr/>
        <!-- Submit panel is split up into two halves -->
        <!-- Left Half -->
        <div class="row">
          <div class="col-md-6">
          </div>
          <div class="col-md-6">
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <button type="submit" id="submit" class="btn btn-primary ladda-button btn-lg btn-block" disabled>Submit</button>
          </div>
        </div>
      </section>
    </main>
    <footer>
      <div class="container">
        View the source code for this tool <a href="https://github.com/Data-Mechanics/bps-challenge-score">on GitHub</a>.
      </div>
    </footer>
    <script src="js/data.structs.js"></script>
    <script src="js/xlsx.full.min.js"></script>
    <script src="js/dropsheet.js"></script>
    <script>
var sheets = {'Buses':true, 'Stop-Assignments':true, 'Routes':true};
var _target = document.getElementById('drop-area');
var _choose = document.getElementById('choose-file-button');
var spinner;
var _workstart = function() { spinner = new Spinner().spin(_target); }
var _workend = function() {
  spinner.stop();
  $('#simulation_view').show();
  $('#spreadsheet_view').show();  
}
var _badfile = function() { alertify.alert('This file does not appear to be a valid Excel file.', function(){}); };
var _pending = function() { alertify.alert('Please wait until the current file is processed.', function(){}); };
var _large = function(len, cb) { alertify.confirm("This file is " + (len/(1024*1024)).toFixed(2) + " MB and may take a few moments. Your browser may lock up during this process. Continue?", cb); };
var _failed = function(e) { alertify.alert('This format is not supported.', function(){}); };
var boldRenderer = function (instance, td, row, col, prop, value, cellProperties) {
  Handsontable.TextCell.renderer.apply(this, arguments);
  $(td).css({'font-weight': 'bold'});
};
var make_buttons = function(sheetnames, cb) {
  var $buttons = $('#buttons');
  $buttons.html("");
  sheetnames.forEach(function(s,idx) {
    if (s in sheets) {
      var button= $('<button/>').attr({ type:'button', name:'btn' +idx, text:s });
      button.append(s);
      button.click(function() { cb(idx); });
      $buttons.append(button);
    }
  });
};
var $window, availableWidth, availableHeight;
var calculateSize = function () {
  availableWidth = Math.max($('#drop').width(), 600);
  availableHeight = Math.max($window.height() - 250, 400);
};
var _onsheet = function(json, cols, sheetnames, select_sheet_cb) {
  make_buttons(sheetnames, select_sheet_cb);
  calculateSize();
  if (!json) json = []; /* add header row for table */
  json.unshift(function(head){var o = {}; for(i=0;i!=head.length;++i) o[head[i]] = head[i]; return o;}(cols));
  calculateSize();
  $("#hot").handsontable({
    data: json,
    startRows: 5, startCols: 3, fixedRowsTop: 1,
    stretchH: 'all',
    rowHeaders: true,
    columns: cols.map(function(x) { return {data:x}; }),
    colHeaders: cols.map(function(x,i) { return XLS.utils.encode_col(i); }),
    cells: function (r,c,p) { if(r === 0) this.renderer = boldRenderer; },
    width: function () { return availableWidth; },
    height: function () { return availableHeight; },
    stretchH: 'all'
  });
};
$(document).ready(function() {
  $window = $(window);
  $window.on('resize', calculateSize);
});
var workbook_js = DropSheet({
  drop: _target, choose: _choose,
  on: { workstart: _workstart, workend: _workend, sheet: _onsheet },
  errors: { badfile: _badfile, pending: _pending, failed: _failed, large: _large }
}, sheets);
//$("#hot").hide();
var clusterize = new Clusterize({scrollId:'scrollArea', contentId:'contentArea'});
$('#tables-area').hide();
$('#expand-table-button').click(function (e) {
  $('#tables-area').slideToggle();
  $(e.target).toggleClass('flip');
});
    </script>
    <script src="js/simulation.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/spin.js/2.3.2/spin.min.js"></script>
  </body>
</html>